using http_headers_exploit.website_data;
using System.Text.Json;

namespace http_headers_exploit;

public class ExploitClient
{

    private readonly HttpClient client = new HttpClient(); // Client configuration

    public void RequestLoop(string websitesJson) {
        List<Website> websiteList = (List<Website>) JsonSerializer.Deserialize(websitesJson, typeof(List<Website>))!;

        Statistics statistics = new Statistics();
        foreach (var website in websiteList)
        {
            HttpRequestMessage requestMessage = new HttpRequestMessage(HttpMethod.Head, website.url);
            HttpResponseMessage responseMessage = client.SendAsync(requestMessage).Result;
            statistics.AddStatistic(responseMessage);
        }

        Console.WriteLine(statistics);
    }
}
