document.addEventListener('DOMContentLoaded', init, false);

function init(){
    loadExerciseTwo();
    loadExerciseThree();
    loadExerciseOne();   
}

function loadExerciseOne() {
    fetch("http://localhost:8080/popularity").then(async response => {
        let data = await response.json();
        document.getElementById("q1Loading").remove();
        let exerciseDiv = document.getElementById("exerciseOneResponse");
        data.forEach(server => {
            if(server.serverName.length < 30) {
                let tr = document.createElement("tr");

                let td = document.createElement("td");
                td.innerText = server.serverName;
                tr.appendChild(td);
    
                td = document.createElement("td");
                td.innerText = Math.round(server.percentage * 100) + "%";
                tr.appendChild(td);
    
                exerciseDiv.appendChild(tr);  
            }
        });
    });
}

function loadExerciseTwo() {
    fetch("http://localhost:8080/age").then(async response => {
        let data = await response.json();
        document.getElementById("q2Loading").remove();
        let exerciseDiv = document.getElementById("exerciseTwoResponse");
        
        let td = document.createElement("td");
        td.innerText = data.averageAge;
        exerciseDiv.appendChild(td);

        td = document.createElement("td");
        td.innerText = data.standardDeviationAge;
        exerciseDiv.appendChild(td);
    });
}

function loadExerciseThree() {
    fetch("http://localhost:8080/other").then(async response => {
        document.getElementById("q3Loading").remove();
        let data = await response.json();

        // First scenario
        document.getElementById("timeOutSpan").innerText = Math.round(data.timeOutRate * 100) + "%";

        // Second scenario
        serverCodeDiv = document.getElementById("serverCode");
        data.statueCodeStatistics.forEach(statueCodeStatistic => {
            let tr = document.createElement("tr");

            let td = document.createElement("td");
            td.innerText = statueCodeStatistic.statueCode;
            tr.appendChild(td);

            td = document.createElement("td");
            td.innerText = Math.round(statueCodeStatistic.percentage * 100) + "%";
            tr.appendChild(td);

            serverCodeDiv.appendChild(tr);
        });

        // Third scenario
        document.getElementById("cookieAgeSpan").innerText = data.cookieAverageAge;
    });
}